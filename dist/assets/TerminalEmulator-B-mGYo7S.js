import{r as v,u as I,g as S,j as g,T as E,C as U}from"./index-Ck54f30e.js";function $(i){const o=i.hostname;switch(i.mode){case"user":return`${o}>`;case"privileged":return`${o}#`;case"config":return`${o}(config)#`;case"config-if":return`${o}(config-if)#`}}function N(i){return{hostname:i??"Router",mode:"user",currentInterface:null,history:[],output:["╔══════════════════════════════════════════════════╗","║        NetBuilder Academy — CLI Emulator         ║","║   Digite 'help' para ver os comandos disponíveis ║","╚══════════════════════════════════════════════════╝",""]}}function R(i,o,e){const t=i.trim(),n=[...o.history,t],r=`${$(o)} ${t}`;if(!t)return{output:[...o.output,r],newState:{...o,history:n}};const s=t.split(/\s+/),c=s[0].toLowerCase(),l=s.slice(1);switch(o.mode){case"user":return j(c,l,o,e,r,n);case"privileged":return M(c,l,o,e,r,n);case"config":return H(c,l,o,e,r,n);case"config-if":return P(c,l,o,e,r,n)}}function j(i,o,e,t,n,r){switch(i){case"enable":case"en":return a(e,r,n,[],"privileged");case"help":case"?":return a(e,r,n,["Comandos disponíveis (modo USER):","  enable       Entrar no modo privilegiado","  help         Mostrar esta ajuda","  exit         Sair do terminal"]);case"exit":case"quit":return a(e,r,n,["--- Terminal fechado ---"]);default:return a(e,r,n,[`% Comando não reconhecido: '${i}'`,"  Digite 'help' para ver os comandos disponíveis."])}}function M(i,o,e,t,n,r){var s,c,l,f;switch(i){case"configure":case"conf":{const u=(s=o[0])==null?void 0:s.toLowerCase();return u==="terminal"||u==="t"?a(e,r,n,["Enter configuration commands, one per line. End with 'exit'."],"config"):a(e,r,n,["% Uso: configure terminal"])}case"show":return V(o,e,t,n,r);case"ping":{const u=o[0];return u?a(e,r,n,[`Sending 5, 100-byte ICMP Echos to ${u}, timeout is 2 seconds:`,"!!!!!","Success rate is 100 percent (5/5), round-trip min/avg/max = 1/2/4 ms"]):a(e,r,n,["% Uso: ping <ip-address>"])}case"write":{const u=(c=o[0])==null?void 0:c.toLowerCase();return!u||u==="memory"||u==="mem"?t.onSaveConfig?(t.onSaveConfig(),a(e,r,n,["Building configuration...","[OK]"])):a(e,r,n,["Building configuration...","[OK] (nota: persistência virtual não inicializada)"]):a(e,r,n,["% Uso: write memory"])}case"copy":{const u=(l=o[0])==null?void 0:l.toLowerCase(),p=(f=o[1])==null?void 0:f.toLowerCase();return(u==="running-config"||u==="run")&&(p==="startup-config"||p==="start")?(t.onSaveConfig&&t.onSaveConfig(),a(e,r,n,["Destination filename [startup-config]?","Building configuration...","[OK]"])):a(e,r,n,["% Uso: copy running-config startup-config"])}case"disable":return a(e,r,n,[],"user");case"exit":case"quit":return a(e,r,n,[],"user");case"help":case"?":return a(e,r,n,["Comandos disponíveis (modo PRIVILEGIADO):","  configure terminal       Entrar no modo de configuração","  show ip interface brief  Ver resumo das interfaces","  show ip route            Ver tabela de roteamento","  show running-config      Ver configuração atual","  show interfaces          Ver detalhes das interfaces","  ping <ip>                Testar conectividade","  write memory             Salvar configuração","  copy run start           Copiar running → startup config","  disable                  Voltar ao modo user","  exit                     Voltar ao modo user"]);default:return a(e,r,n,[`% Comando não reconhecido: '${i}'`])}}function H(i,o,e,t,n,r){var s,c,l;switch(i){case"hostname":{const f=o[0];return f?{output:[...e.output,n],newState:{...e,hostname:f,mode:"config",history:r}}:a(e,r,n,["% Uso: hostname <nome>"])}case"ip":{if(((s=o[0])==null?void 0:s.toLowerCase())==="route"){const u=o[1],p=o[2],w=o[3];if(!u||!p||!w)return a(e,r,n,["% Uso: ip route <network> <mask> <next-hop>","  Ex: ip route 10.0.0.0 255.255.255.0 192.168.1.1"]);const x=/^(\d{1,3}\.){3}\d{1,3}$/;return!x.test(u)||!x.test(p)||!x.test(w)?a(e,r,n,["% Endereço de rede, máscara ou next-hop em formato inválido."]):t.onAddStaticRoute?(t.onAddStaticRoute(u,p,w),a(e,r,n,[])):a(e,r,n,["% Roteamento estático não disponível neste dispositivo."])}return a(e,r,n,["% Subcomando IP não reconhecido no modo config.","  Uso: ip route <network> <mask> <next-hop>"])}case"no":{const f=(c=o[0])==null?void 0:c.toLowerCase();if(f==="ip"&&((l=o[1])==null?void 0:l.toLowerCase())==="route"){const u=o[2],p=o[3],w=o[4];return!u||!p||!w?a(e,r,n,["% Uso: no ip route <network> <mask> <next-hop>"]):t.onRemoveStaticRoute?(t.onRemoveStaticRoute(u,p,w),a(e,r,n,[])):a(e,r,n,["% Roteamento estático não disponível neste dispositivo."])}return a(e,r,n,[`% Subcomando 'no ${f}' não reconhecido no modo config.`])}case"interface":case"int":{const f=o.join(" ");if(!f)return a(e,r,n,["% Uso: interface <nome>","  Ex: interface GigabitEthernet0/0"]);const u=G(t.deviceData.interfaces,f);return u?{output:[...e.output,n],newState:{...e,mode:"config-if",currentInterface:u.id,history:r}}:a(e,r,n,[`% Interface '${f}' não encontrada.`,"  Use 'show ip interface brief' para ver as interfaces disponíveis."])}case"exit":case"end":return a(e,r,n,[],"privileged");case"help":case"?":return a(e,r,n,["Comandos disponíveis (modo CONFIG):","  hostname <nome>              Definir hostname do dispositivo","  interface <nome>             Entrar na configuração de interface","  ip route <net> <mask> <nh>   Adicionar rota estática","  no ip route <net> <mask> <nh>  Remover rota estática","  exit                         Voltar ao modo privilegiado"]);default:return a(e,r,n,[`% Comando não reconhecido: '${i}'`])}}function P(i,o,e,t,n,r){var c,l,f;const s=t.deviceData.interfaces.find(u=>u.id===e.currentInterface);if(!s)return a(e,r,n,["% Erro: interface não encontrada no dispositivo."],"config");switch(i){case"ip":{if(((c=o[0])==null?void 0:c.toLowerCase())==="address"){const p=o[1],w=o[2];if(!p||!w)return a(e,r,n,["% Uso: ip address <ip> <máscara>","  Ex: ip address 192.168.1.1 255.255.255.0"]);const x=/^(\d{1,3}\.){3}\d{1,3}$/;return!x.test(p)||!x.test(w)?a(e,r,n,["% Endereço IP ou máscara em formato inválido."]):(t.onUpdateInterface(s.id,{ipConfig:{address:p,mask:w}}),a(e,r,n,[]))}return a(e,r,n,["% Subcomando IP não reconhecido. Uso: ip address <ip> <mask>"])}case"no":{const u=(l=o[0])==null?void 0:l.toLowerCase();return u==="shutdown"?(t.onUpdateInterface(s.id,{adminUp:!0}),a(e,r,n,[])):u==="ip"&&((f=o[1])==null?void 0:f.toLowerCase())==="address"?(t.onUpdateInterface(s.id,{ipConfig:void 0}),a(e,r,n,[])):a(e,r,n,[`% Subcomando 'no ${u}' não reconhecido.`])}case"shutdown":return t.onUpdateInterface(s.id,{adminUp:!1}),a(e,r,n,[]);case"description":case"desc":return a(e,r,n,[]);case"exit":return{output:[...e.output,n],newState:{...e,mode:"config",currentInterface:null,history:r}};case"help":case"?":return a(e,r,n,[`Comandos disponíveis (config-if: ${s.shortName}):`,"  ip address <ip> <mask>  Definir endereço IP","  no ip address           Remover endereço IP","  shutdown                Desabilitar interface","  no shutdown             Habilitar interface","  exit                    Voltar ao modo config"]);default:return a(e,r,n,[`% Comando não reconhecido: '${i}'`])}}function V(i,o,e,t,n){const r=i.join(" ").toLowerCase();if(r==="ip interface brief"||r==="ip int brief"||r==="ip int br"){const s=A(e.deviceData);return a(o,n,t,s)}if(r==="interfaces"||r==="int"){const s=T(e.deviceData);return a(o,n,t,s)}if(r==="running-config"||r==="run"){const s=B(o,e.deviceData,e);return a(o,n,t,s)}if(r==="ip route"||r==="ip ro"){const s=K(e);return a(o,n,t,s)}return r==="version"||r==="ver"?a(o,n,t,[`NetBuilder Academy Virtual ${e.deviceData.deviceType}`,`Hostname: ${o.hostname}`,`Model: ${e.deviceData.hardwareModel??"Generic"}`,`Interfaces: ${e.deviceData.interfaces.length}`]):a(o,n,t,["% Subcomando show não reconhecido.","  show ip interface brief | show ip route | show interfaces | show running-config | show version"])}function A(i){const o="Interface                  IP-Address      OK? Method Status                Protocol",e="─".repeat(o.length),t=i.interfaces.map(n=>{var p;const r=n.name.padEnd(27),s=(((p=n.ipConfig)==null?void 0:p.address)??"unassigned").padEnd(16),c="YES".padEnd(4),l="manual".padEnd(7),f=n.adminUp?(n.connectedEdgeId?"up":"down").padEnd(22):"administratively down ".padEnd(22),u=n.adminUp&&n.connectedEdgeId?"up":"down";return`${r}${s}${c}${l}${f}${u}`});return[o,e,...t]}function T(i){const o=[];for(const e of i.interfaces)o.push(`${e.name} is ${e.adminUp?"up":"administratively down"}, line protocol is ${e.adminUp&&e.connectedEdgeId?"up":"down"}`),o.push(`  Hardware is ${e.type.toUpperCase()}, address is ${e.macAddress}`),e.ipConfig&&o.push(`  Internet address is ${e.ipConfig.address}/${e.ipConfig.mask}`),o.push(`  MTU 1500 bytes, BW ${O(e.speed)}, DLY 10 usec`),o.push(`  ${e.poe!=="none"?`PoE: ${e.poe==="in"?"powered":"supplying"}`:""}`),o.push("");return o}function K(i){var t;const o=((t=i.getRoutes)==null?void 0:t.call(i))??[];if(o.length===0)return["Codes: C - connected, S - static","","Gateway of last resort is not set.","","  (nenhuma rota configurada)"];const e=["Codes: C - connected, S - static, L - local",""];for(const n of o){const r=n.type==="connected"?"C":n.type==="static"?"S":"L",s=`${n.network}/${n.mask}`,c=n.nextHop?`via ${n.nextHop}`:n.outInterface?`directly connected, ${n.outInterface}`:"",l=n.metric>0?` [${n.adminDistance}/${n.metric}]`:"";e.push(`${r}    ${s} ${c}${l}`)}return e}function B(i,o,e){var s;const t=["Building configuration...","","Current configuration:","!",`hostname ${i.hostname}`,"!"];for(const c of o.interfaces)t.push(`interface ${c.name}`),c.ipConfig&&t.push(` ip address ${c.ipConfig.address} ${c.ipConfig.mask}`),c.adminUp||t.push(" shutdown"),t.push("!");const r=(((s=e==null?void 0:e.getRoutes)==null?void 0:s.call(e))??[]).filter(c=>c.type==="static");if(r.length>0){for(const c of r)t.push(`ip route ${c.network} ${c.mask} ${c.nextHop??""}`);t.push("!")}return t.push("","end"),t}function O(i){return{"10M":"10000 Kbit","100M":"100000 Kbit","1G":"1000000 Kbit","10G":"10000000 Kbit"}[i]??i}function G(i,o){const e=o.toLowerCase().replace(/\s+/g,"");return i.find(t=>{const n=t.name.toLowerCase().replace(/\s+/g,""),r=t.shortName.toLowerCase().replace(/\s+/g,"");return n===e||r===e||n.startsWith(e)||r.startsWith(e)})}function a(i,o,e,t,n){return{output:[...i.output,e,...t],newState:{...i,mode:n??i.mode,history:o,currentInterface:n==="config"||n==="privileged"||n==="user"?null:i.currentInterface}}}const q={user:["enable","help","exit"],privileged:["configure terminal","show ip interface brief","show ip route","show interfaces","show running-config","show version","ping","write memory","copy running-config startup-config","disable","exit","help"],config:["hostname","interface","ip route","no ip route","exit","end","help"],"config-if":["ip address","no ip address","shutdown","no shutdown","description","exit","help"]};function z(i,o){const e=i.toLowerCase();return q[o].filter(t=>t.startsWith(e))}const W=v.memo(({nodeId:i})=>{const o=I(d=>d.nodes.find(m=>m.id===i)),e=I(d=>d.updateNodeData),[t,n]=v.useState(()=>{o!=null&&o.data.hardwareModel&&S(o.data.hardwareModel);const d=(o==null?void 0:o.data.label.replace(/\s+\d+$/,""))??"Device";return N(d)}),[r,s]=v.useState(""),[c,l]=v.useState(-1),f=v.useRef(null),u=v.useRef(null);v.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[t.output]),v.useEffect(()=>{var d;(d=u.current)==null||d.focus()},[]);const p=v.useCallback((d,m)=>{if(!o)return;const h=o.data.interfaces.map(b=>b.id===d?{...b,...m}:b);e(i,{interfaces:h})},[o,i,e]),w=v.useCallback(d=>{e(i,d)},[i,e]),x=v.useCallback(d=>{if(d.preventDefault(),!o)return;const m={deviceData:o.data,onUpdateData:w,onUpdateInterface:p},h=R(r,t,m);n(h.newState),s(""),l(-1)},[r,t,o,w,p]),k=v.useCallback(d=>{if(d.key==="ArrowUp"){d.preventDefault();const m=t.history;if(m.length===0)return;const h=c===-1?m.length-1:Math.max(0,c-1);l(h),s(m[h])}else if(d.key==="ArrowDown"){d.preventDefault();const m=t.history;if(c===-1)return;const h=c+1;h>=m.length?(l(-1),s("")):(l(h),s(m[h]))}else if(d.key==="Tab"){d.preventDefault();const m=z(r,t.mode);m.length===1?s(m[0]+" "):m.length>1&&n(h=>({...h,output:[...h.output,`${$(h)} ${r}`,m.map(b=>`  ${b}`).join(`
`)]}))}},[t,c,r]);if(!o)return null;const C=o.data.hardwareModel?S(o.data.hardwareModel):void 0;if(!((C==null?void 0:C.hasCli)??!1))return g.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4 py-8",children:[g.jsx(E,{size:32,className:"text-gray-600 mb-3"}),g.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"CLI Indisponível"}),g.jsxs("p",{className:"text-[11px] text-gray-600 mt-1",children:["Este dispositivo (",(C==null?void 0:C.modelName)??o.data.deviceType,") não suporta terminal de comandos."]})]});const D=$(t);return g.jsxs("div",{className:"flex flex-col h-full bg-slate-950",onClick:()=>{var d;return(d=u.current)==null?void 0:d.focus()},children:[g.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-900/80 border-b border-white/5",children:[g.jsx(E,{size:12,className:"text-green-400"}),g.jsx("span",{className:"text-[10px] font-mono text-green-400",children:(C==null?void 0:C.firmware)??"CLI"}),g.jsx("span",{className:"text-[10px] text-gray-600 ml-auto font-mono",children:t.mode.toUpperCase()})]}),g.jsx("div",{ref:f,className:"flex-1 overflow-y-auto px-3 py-2 font-mono text-[11px] leading-relaxed text-green-300 custom-scrollbar",role:"log","aria-label":"Saída do terminal","aria-live":"polite",children:t.output.map((d,m)=>g.jsx("div",{className:"whitespace-pre-wrap break-all",children:d},m))}),g.jsxs("form",{onSubmit:x,className:"flex items-center px-3 py-2 border-t border-white/5 bg-slate-900/50",children:[g.jsx("span",{className:"text-green-400 font-mono text-[11px] flex-shrink-0 mr-1",children:D}),g.jsx(U,{size:10,className:"text-green-600 flex-shrink-0 mr-1"}),g.jsx("input",{ref:u,type:"text",value:r,onChange:d=>s(d.target.value),onKeyDown:k,"aria-label":"Entrada de comando CLI",autoComplete:"off",spellCheck:!1,className:"flex-1 bg-transparent text-green-300 font-mono text-[11px] outline-none caret-green-400 placeholder-green-800",placeholder:"Digite um comando..."})]})]})});W.displayName="TerminalEmulator";export{W as default};
